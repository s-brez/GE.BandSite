# Implementation Plan

- [x] Stage 1: Site Shell & Home Demo
  - **Scope**
    - Replace the scaffolded layout/home page with the Swing The Boogie experience described in `docs/client-requirements.md`.
    - Establish navigation/footer links, hero section, and value snapshots so the marketing team can demo a polished landing page quickly.
    - Use existing sample assets (local or S3 URLs) to showcase imagery/video; wire the CTA to the upcoming Contact page route.
  - **Key Files**
    - `GE.BandSite.Server/Pages/Shared/_Layout.cshtml` – overwrite placeholder markup with header/nav/footer.
    - `GE.BandSite.Server/Pages/Index.cshtml` & code-behind – replace the default template text with hero/value snapshot sections and CTA button.
    - `GE.BandSite.Server/wwwroot/css/site.css` – implement the black base + red accent palette, typography, and responsive grid.
    - Remove scaffolded privacy link/placeholder content to avoid regressions later.
  - **UI Outputs**
    - Desktop/mobile header with nav: Home, About, Services, Media, Contact (links may 404 until Stage 2, but routes must be added).
    - Hero containing full-width band image, tagline “The world-class swing band bringing the vibe to your event,” supporting copy, and `Book Your Event` button.
    - Value snapshot row covering corporate events, weddings, band flexibility, international experience.
    - Highlight video section (placeholder `<video>` or still image with play button) referencing future gallery.
  - **Infrastructure**
    - Ensure static assets are served locally but keep references easily swappable for S3/CloudFront.
    - Wire nav links to the expected Razor Page routes (even if not yet implemented) so hash-based highlighting works once pages exist.
  - **Testing**
    - Unit: add a simple view-model/page-model test ensuring title + CTA text values.
    - Manual: Validate responsive breakpoints (320, 768, 1440) and verify nav/footer/hardcoded links render correctly.
  - **Acceptance Criteria**
    - Home page renders without errors, uses brand palette, contains hero/value snapshot/video sections, and CTA button works.
    - Layout can be reused by later pages; no leftover template/placeholder artifacts remain.

- [x] Stage 2: Public Pages Read-Only
  - **Scope**
    - Implement About, Band Lineup, Services, Media, Testimonials, Events, Contact pages as Razor Pages consuming in-memory view models (no DB yet).
    - Apply copy from `docs/client-requirements.md`; ensure navigation highlights active page.
  - **Key Files**
    - Create `Pages/About/Index.cshtml(.cs)`, `Pages/Band`, `Pages/Services`, `Pages/Media`, `Pages/Testimonials`, `Pages/Events`, `Pages/Contact`.
    - Shared partials (e.g., `_SectionHeader`, `_TestimonialCard`) if repeated structures emerge.
  - **UI Outputs**
    - Each page reflects the brief: timeline/story, lineup tiles, service packages, gallery placeholders, testimonial quotes, events list, contact form stub.
  - **Infrastructure**
    - Source view data from constants/records so transition to EF in later stages is isolated.
  - **Testing**
    - Unit tests verifying page models provide expected counts/strings.
    - Manual navigation sweep – all routes reachable with back/forward.
  - **Acceptance Criteria**
    - All public routes exist, display copy/imagery placeholders, and share consistent styling.

- [x] Stage 3: Contact Pipeline
  - **Scope**
    - Activate the Contact form: validation, persist submissions to PostgreSQL, send SES notifications, expose admin-only listing.
  - **Key Files**
    - Contact page model (`Pages/Contact/Index.cshtml.cs`) – hook into new service.
    - `GE.BandSite.Server/Features/Contact/ContactSubmissionService.cs`, DTOs, and DI registration.
    - `GE.BandSite.Database/Entities/ContactSubmission.cs` + context wiring.
    - Admin Razor Pages under `Pages/Admin/ContactSubmissions` for listing/deletion.
  - **Enhancements**
    - Admin-manageable contact notification recipients with multi-address support and SES integration coverage.
  - **Testing**
    - Unit: service persistence/validation/email builder.
    - Integration: POST `/Contact` stores record; admin list requires auth.
    - [x] Explicit SES integration test dispatches a live contact notification (run `ContactSubmissionSesLiveTests` once per credentials rotation).
  - **Acceptance Criteria**
    - Valid submissions store data + email via SES; errors return user-friendly validation messages.
    - Admin listing shows entries and supports deletion.

- [x] Stage 4: Media Storage & Delivery
  - **Scope**
    - Introduce media entities/services; have public Home/Media pages read from PostgreSQL instead of hardcoded data; serve assets from CloudFront OAC URLs.
  - **Key Files**
    - `MediaAsset`/`MediaTag` entities, DbContext configuration, query service (`IMediaQueryService`).
    - Update Home/Media Razor Pages to consume the service.
  - **Testing**
    - Unit tests for query service filtering logic.
    - Integration test ensuring `/Media` returns CloudFront URLs.
  - **Acceptance Criteria**
    - Public pages display data exclusively from DB; no inline media definitions remain.
    - [x] Media gallery thumbnails adapt to asset aspect ratio and expand with a lightbox preview.

- [x] Stage 5: Video Processing Backbone
  - **Scope**
    - Implement hosted service that processes pending video assets (ffmpeg MOV→MP4), writes metadata, and updates status.
  - **Key Files**
    - Background service (`MediaProcessingHostedService`), queue/transcoder abstractions, configuration (`MediaProcessingOptions`).
  - **Testing**
    - Unit tests for queue selection, ffmpeg command generation (via abstraction), metadata updates.
    - Integration test stubbing S3/ffmpeg to verify state transitions.
  - **Acceptance Criteria**
    - Pending videos move to Ready state with playback keys; failures mark error details.

- [x] Stage 6: Authentication & Admin Portal
  - **Scope**
    - Leverage existing auth stack (login service, JWT middleware) to build admin layout and CRUD Razor Pages for testimonials/events/band/media metadata/contact submissions.
  - **Key Files**
    - `Pages/Admin/*` Razor Pages + layout.
    - Services for testimonials/events/band metadata.
  - **Testing**
    - Unit tests for CRUD services/page handlers and authentication flows.
    - Integration tests covering login, session persistence, access control.
  - **Acceptance Criteria**
    - Admin users can log in/out, navigate admin dashboard, edit datasets; all admin routes secured.
  - [x] Admin password reset emails via SES with request + tokenized reset pages reusing existing hashing/validation services.

- [x] Stage 7: Media Upload Interface
  - **Scope**
    - Extend admin media pages with presigned S3 uploads for photos/videos/posters, update metadata, trigger Stage 5 processing.
  - **Key Files**
    - Upload service generating presigned URLs, admin JS, status indicators.
  - **Testing**
    - Unit: upload service & command handlers.
    - Integration: simulate upload + metadata update -> processing pipeline marks ready.
  - **Acceptance Criteria**
    - Staff can upload/manage media end-to-end; processing status visible; publish/unpublish toggles reflect on public site.
    - [x] Media placement checkboxes persist and drive media/home hero selections.

- [x] Stage 8: Operations Hardening
  - **Scope**
    - Deliver nightly `pg_dump` backups to S3 with 30-day retention; configure Serilog retention; document deployment/rollback/backups/ffmpeg/SES.
  - **Key Files**
    - Backup hosted service/config, runbook in `docs/operations-runbook.md`.
  - **Testing**
    - Unit: backup scheduling logic, options validation.
    - Integration: dry-run backup job with stubbed pg_dump/S3.
    - Manual: run backup in staging, verify S3 object & retention, exercise runbook steps, confirm CloudFront/Route 53/SES checks.
  - **Acceptance Criteria**
    - Backup job runs, enforces retention, and is documented; log retention configured; ops runbook complete; manual validation recorded.

- [x] Stage 9: Local Transcode Pipeline
  - **Scope**
    - Auto-import existing photos/videos from the configured S3 bucket so real assets populate `MediaAsset` on startup and legacy sources enter the transcode queue.
    - Reprocess existing `.mov` assets by resetting their processing state so the hosted service produces MP4 playbacks without manual intervention.
    - Ensure all admin-uploaded .mov sources are transcoded to browser-safe MP4 versions inside the app's existing media processing loop.
    - Store raw masters under the existing raw prefixes, publish transcoded MP4s under the playback prefix, and keep metadata aligned.
    - Update fallback media and public queries so the home page and gallery always render processed MP4 assets.
  - **Key Files**
    - `GE.BandSite.Server/Features/Media/Admin/MediaAdminService.cs` – queue uploads with raw paths and pending state.
    - `GE.BandSite.Server/Features/Media/Processing/*` – coordinator, hosted service, and `FfmpegMediaTranscoder` improvements for MP4 output.
    - `GE.BandSite.Server/Features/Media/Storage/MediaStorageService.cs` & options – ensure processed uploads land under playback prefixes and S3 content-types.
    - `GE.BandSite.Server/Pages/Index.cshtml(.cs)` – update fallback/media URLs once MP4 outputs exist.
  - **Infrastructure**
    - Document backlog requeue steps: identify `.mov` assets in S3/DB, mark them `Pending`, and let the hosted service regenerate MP4 playback paths.
    - Require platform-specific FFmpeg paths (`MediaProcessingOptions.FfmpegPathWindows` / `MediaProcessingOptions.FfmpegPathUnix`, with `FfmpegPath` as fallback) and temp directories per environment; document FFmpeg installation for Windows/Linux.
    - Keep hosted service single-threaded; add logging/metrics for conversion start, success, failure.
    - Ensure S3 playback prefix (or CloudFront) exposes MP4s with `video/mp4` content-type and CORS/range headers.
  - **Testing**
    - Manual: requeue an existing `.mov`, verify MP4 playback appears in S3 and the public site, then remove any legacy `.mov` playback references.
    - Unit: command generation/error handling in `FfmpegMediaTranscoder`, admin service validations.
    - Integration: seed a raw `.mov`, run `MediaProcessingCoordinator`, assert MP4 playback path and ready state.
    - Integration (explicit): fetch the published MP4 over HTTPS via pre-signed or public URL and validate partial content response.
  - **Acceptance Criteria**
    - Uploaded `.mov` assets yield published `.mp4` playback keys with duration metadata and posters.
    - Public pages exclusively reference MP4 URLs; hero fallback video is MP4 and plays in modern browsers.
    - Automated tests and manual runs confirm end-to-end processing, S3 delivery, and browser playback.

- [x] Minor UI polish
  - Enlarge header brand and hero titles for improved hierarchy.
  - Stack footer logo text with centered lines and refreshed color treatment.
  - Lift hero overlay higher in the frame for stronger above-the-fold impact.
  - [x] Update highlight video layout and playback to use the static looping showcase reel.
